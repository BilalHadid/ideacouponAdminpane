{"version":3,"file":"index.es.js","sources":["../src/index.js"],"sourcesContent":["import sortBy from \"sort-by\";\nconst convertFileToBase64 = (file) =>\n  new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () =>\n      resolve({\n        result: reader.result,\n        type: file.type,\n        title: file.title,\n        size: file.rawFile.size,\n      });\n    reader.onerror = reject;\n    reader.readAsDataURL(file.rawFile);\n  });\nexport default (\n  firebase,\n  settings = { context: \"\", imagekey: \"images\", filekey: \"files\" }\n) => {\n  const database = firebase.default.database();\n  return {\n    create: (source, params) => {\n      const resource = [settings.context, source].join(\"/\");\n      let uid = params.data.id || database.ref().child(resource).push().key;\n\n      let create =\n        !params.data[settings.imagekey] && !params.data[settings.filekey]\n          ? new Promise((resolve, reject) => {\n              let ref = database.ref([resource, uid].join(\"/\"));\n              ref.set({ ...params.data, id: uid });\n              resolve();\n            })\n          : Promise.all(\n              (!params.data[settings.imagekey]\n                ? []\n                : params.data[settings.imagekey] instanceof Array\n                ? params.data[settings.imagekey]\n                : [params.data[settings.imagekey]]\n              )\n                .map((img) => {\n                  return { ...img, type: \"image\" };\n                })\n                .map(convertFileToBase64)\n                .concat(\n                  (!params.data[settings.filekey]\n                    ? []\n                    : params.data[settings.filekey] instanceof Array\n                    ? params.data[settings.filekey]\n                    : [params.data[settings.filekey]]\n                  )\n                    .map((file) => {\n                      return { ...file, type: \"file\" };\n                    })\n                    .map(convertFileToBase64)\n                )\n            )\n              .then((base64ed) =>\n                base64ed.map((item64, key) => ({\n                  src: item64.result,\n                  id: `${params.data.id}_${item64.type}_${key}`,\n                  title: item64.title,\n                  type: item64.type,\n                  size: item64.size,\n                }))\n              )\n              .then((transformedNewItems) => {\n                database\n                  .ref([resource, uid].join(\"/\"))\n                  .set({\n                    ...params.data,\n                    [settings.imagekey]: transformedNewItems.filter(\n                      (i) => i.type === \"image\"\n                    ),\n                    [settings.filekey]: transformedNewItems.filter(\n                      (i) => i.type === \"file\"\n                    ),\n                    id: uid,\n                  });\n              });\n\n      return create.then((res) => {\n        return { data: { ...params.data, id: uid } };\n      });\n    },\n    update: (source, params) => {\n      const resource = [settings.context, source].join(\"/\");\n      let update =\n        !params.data[settings.imagekey] && !params.data[settings.filekey]\n          ? new Promise((resolve, reject) => {\n              database.ref([resource, params.id].join(\"/\")).set(params.data);\n              resolve();\n            })\n          : Promise.all(\n              (!params.data[settings.imagekey]\n                ? []\n                : params.data[settings.imagekey] instanceof Array\n                ? params.data[settings.imagekey]\n                : [params.data[settings.imagekey]]\n              )\n                .filter((p) => p.rawFile instanceof File)\n                .map((img) => {\n                  return { ...img, type: \"image\" };\n                })\n                .map(convertFileToBase64)\n                .concat(\n                  (!params.data[settings.filekey]\n                    ? []\n                    : params.data[settings.filekey] instanceof Array\n                    ? params.data[settings.filekey]\n                    : [params.data[settings.filekey]]\n                  )\n                    .filter((p) => p.rawFile instanceof File)\n                    .map((file) => {\n                      return { ...file, type: \"file\" };\n                    })\n                    .map(convertFileToBase64)\n                )\n            )\n              .then((base64ed) =>\n                base64ed.map((item64, key) => ({\n                  src: item64.result,\n                  id: `${params.data.id}_${item64.type}_${key}`,\n                  title: item64.title,\n                  type: item64.type,\n                  size: item64.size,\n                }))\n              )\n              .then((transformedNewItems) => {\n                database.ref([resource, params.id].join(\"/\")).set({\n                  ...params.data,\n                  [settings.imagekey]: [\n                    ...transformedNewItems.filter((i) => i.type === \"image\"),\n                    ...(!params.data[settings.imagekey]\n                      ? []\n                      : params.data[settings.imagekey] instanceof Array\n                      ? params.data[settings.imagekey]\n                      : [params.data[settings.imagekey]]\n                    ).filter((p) => !(p.rawFile instanceof File)),\n                  ],\n                  [settings.filekey]: [\n                    ...transformedNewItems.filter((i) => i.type === \"file\"),\n                    ...(!params.data[settings.filekey]\n                      ? []\n                      : params.data[settings.filekey] instanceof Array\n                      ? params.data[settings.filekey]\n                      : [params.data[settings.filekey]]\n                    ).filter((p) => !(p.rawFile instanceof File)),\n                  ],\n                });\n              });\n      return update.then((res) => {\n        return { data: params.data };\n      });\n    },\n    getList: async (source, params) => {\n      const resource = [settings.context, source].join(\"/\");\n      const { field } = params.sort;\n      let ref = database.ref(resource);\n      return ref\n        .orderByChild(field)\n        .once(\"value\")\n        .then(function (snapshot) {\n          let valuesToReturn = snapshot.val()\n            ? Object.values(snapshot.val())\n            : [];\n          if (params.filter) {\n            let filterset = params.filter;\n            filterset = Object.assign(\n              filterset,\n              filterset.q ? { id: filterset.q } : {}\n            );\n            delete filterset.q;\n            const filters = Object.entries(filterset);\n            filters.forEach(([filterKey, filterValue]) => {\n              valuesToReturn = valuesToReturn.filter((value) => {\n                if (\n                  value &&\n                  value[filterKey] &&\n                  typeof value[filterKey] !== \"object\"\n                ) {\n                  const propsToFilter = `${value[filterKey]}`.toLowerCase();\n                  if (propsToFilter.includes(`${filterValue}`.toLowerCase())) {\n                    return true;\n                  }\n                }\n                return false;\n              });\n            });\n          }\n\n          if (params.pagination) {\n            let values = [];\n            values = valuesToReturn;\n            if (params.sort) {\n              values.sort(\n                sortBy(\n                  `${params.sort.order === \"ASC\" ? \"-\" : \"\"}${\n                    params.sort.field\n                  }`\n                )\n              );\n            }\n            const { page, perPage } = params.pagination;\n            const _start = (page - 1) * perPage;\n            const _end = page * perPage;\n            const data = values ? values.slice(_start, _end) : [];\n            const total = snapshot.val()\n              ? Object.keys(snapshot.val()).length\n              : 0;\n\n            return { data, total };\n          } else {\n            throw new Error(\"Error processing request\");\n          }\n        });\n    },\n\n    getOne: async (source, params) => {\n      const resource = [settings.context, source].join(\"/\");\n      let ref = await database.ref([resource, params.id].join(\"/\"));\n      return ref.once(\"value\").then(function (snapshot) {\n        return {\n          data: snapshot.val(),\n        };\n      });\n    },\n\n    getMany: (source, params) => {\n      const resource = [settings.context, source].join(\"/\");\n      let getMany = new Promise((resolve, reject) => {\n        let data = params.ids.map((id) => {\n          return database\n            .ref([resource, id].join(\"/\"))\n            .once(\"value\")\n            .then(function (snapshot) {\n              return snapshot.val();\n            });\n        });\n        resolve(data);\n      });\n      return getMany.then((data) => {\n        return { data: data };\n      });\n    },\n\n    getManyReference: (source, params) => {\n      const resource = [settings.context, source].join(\"/\");\n      let getManyRef = new Promise((resolve, reject) => {\n        let data = params.ids.map((id) => {\n          return database\n            .ref([resource, id].join(\"/\"))\n            .once(\"value\")\n            .then(function (snapshot) {\n              return snapshot.val();\n            });\n        });\n        resolve(data);\n      });\n      return getManyRef.then((data) => {\n        return { data: data };\n      });\n    },\n\n    updateMany: async (source, params) => {\n      const resource = [settings.context, source].join(\"/\");\n      let updateMany = new Promise((resolve, reject) => {\n        params.ids.map((id) => {\n          database\n            .ref([resource, id].join(\"/\"))\n            .once(\"value\")\n            .then(function (snapshot) {\n              let update = new Promise((resolve, reject) => {\n                database\n                  .ref([resource, id].join(\"/\"))\n                  .set(Object.assign(snapshot.val(), params.data));\n                resolve();\n              });\n              return update.then((res) => {\n                return { data: params.data };\n              });\n            });\n        });\n        resolve();\n      });\n      return updateMany.then((res) => {\n        return { data: params.ids };\n      });\n    },\n\n    delete: (source, params) => {\n      const resource = [settings.context, source].join(\"/\");\n      let Delete = new Promise((resolve, reject) => {\n        database.ref([resource, params.id].join(\"/\")).set(null);\n        resolve();\n      });\n      return Delete.then((res) => {\n        return { data: params.previousData };\n      });\n    },\n\n    deleteMany: (source, params) => {\n      const resource = [settings.context, source].join(\"/\");\n      let deleteMany = new Promise((resolve, reject) => {\n        params.ids.map((id) =>\n          database.ref([resource, id].join(\"/\")).set(null)\n        );\n        resolve();\n      });\n      return deleteMany.then((res) => {\n        return { data: params };\n      });\n    },\n  };\n};\n"],"names":["convertFileToBase64","file","Promise","resolve","reject","reader","FileReader","onload","result","type","title","size","rawFile","onerror","readAsDataURL","firebase","settings","context","imagekey","filekey","database","default","create","source","params","resource","join","uid","data","id","ref","child","push","key","set","all","Array","map","img","concat","then","base64ed","item64","src","transformedNewItems","filter","i","res","update","p","File","getList","field","sort","orderByChild","once","snapshot","valuesToReturn","val","Object","values","filterset","assign","q","filters","entries","forEach","filterKey","filterValue","value","babelHelpers.typeof","propsToFilter","toLowerCase","includes","pagination","sortBy","order","page","perPage","_start","_end","slice","total","keys","length","Error","getOne","getMany","ids","getManyReference","getManyRef","updateMany","delete","Delete","previousData","deleteMany"],"mappings":"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"}